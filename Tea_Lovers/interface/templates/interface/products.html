{% extends 'interface/base.html' %}
{% load static %}
{% block content %}
<!-- PRODUCT SEARCH -->
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-12 col-md-10">

            <!-- User Info, Teabag Image and Logout Button -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <p class="logged-in-info" style="margin-bottom: 0;">Logged in as <b>{{ user.username }}</b> &#128512;
                </p>
                <!-- Flex Container for Teabag Image and Logout Button -->
                <div style="display: flex; align-items: center; justify-content: flex-end;">
                    <!-- Teabag Image -->
                    <div style="flex-shrink: 0; position: relative; z-index: 1; ">
                        <a href="#" id="teabag-logout-link">
                            <img src="{% static 'images/teabag-leaning.png' %}" alt="Teabag-Leaning"
                                style="height: 200px; margin-right: -50px; margin-bottom: 40px;">
                        </a>
                    </div>
                    <!-- Logout Button -->
                    <div style="flex-shrink: 0;">
                        <form id="logout-form" action="{% url 'logout' %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-warning btn shadow"
                                style="margin-right: 1px; ">LOGOUT</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
<!-- Product Search -->
<div class="card my-5 grey-background outer-padding">
    <div class="card">
        <h5 class="card-header">Quick Product Search</h5>
        <div class="card-body">
            <!-- Combined form for product search and store selection -->
            <form action="/products/" method="post" style="display: flex; flex-direction: column;">
                {% csrf_token %}
                
                <!-- Product Search Input -->
                {{ form.as_p }}
                <p>Enter product names separated by commas (e.g., oranges, tea)</p>
                
                <!-- Store Selection Checkboxes -->
                <div class="store-selection" style="padding-bottom: 20px;">
                    <strong>Select Stores:</strong><br>
                    <div class="form-check">
                        <input class="form-check-input store-checkbox" type="checkbox" name="stores" value="Sainsburys" id="sainsburysCheckbox">
                        <label class="form-check-label" for="sainsburysCheckbox">Sainsburys</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input store-checkbox" type="checkbox" name="stores" value="Asda" id="asdaCheckbox">
                        <label class="form-check-label" for="asdaCheckbox">Asda</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input store-checkbox" type="checkbox" name="stores" value="Tesco" id="tescoCheckbox">
                        <label class="form-check-label" for="tescoCheckbox">Tesco</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input store-checkbox" type="checkbox" name="stores" value="Morrisons" id="morrisonsCheckbox">
                        <label class="form-check-label" for="morrisonsCheckbox">Morrisons</label>
                    </div>
                    <!-- Add more stores as checkboxes here -->
                </div>

                <!-- Search Button -->
                <button type="submit" class="btn btn-primary mb-3 btn shadow">Search</button>
                
                <!-- Database Action Buttons -->
                <div class="database-actions" style="padding-top: 20px;">
                    <form action="{% url 'delete_all_entries' %}" method="post" style="display: inline-block;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn shadow fs-6">Delete db</button>
                    </form>                                    
                    <form action="{% url 'display_database' %}" method="post" style="display: inline-block; margin-left: 10px;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-primary btn shadow">Display db</button>
                    </form>   
                </div>    
            </form>    
        </div>
    </div>
</div>

        <!-- Tables displaying results from query -->
        <div class="container mt-3">
            <div class="card grey-background"> <!-- Apply the grey-background class here -->
                <div class="card-body custom-padding"> <!-- Apply custom-padding class here -->
                    <!-- Store Table -->
                    <div class="row">
                        <!-- ********************************************************************************** -->
                        <!-- Tesco Table -->
                        <!-- ********************************************************************************** -->
                        <div class="col-12 col-md-6">
                            <br>
                            <br>
                            <h3>Tesco</h3>
                            <table class="table table-striped table-sm" id="tescoTable">
                                <thead>
                                    <tr>
                                        <th scope="col">Store</th>
                                        <th scope="col">Name</th>
                                        <th scope="col">Price</th>
                                        <th scope="col">Add</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for product in tesco_products %}
                                    <tr>
                                        <td>{{ product.store }}</td>
                                        <td>{{ product.name }}</td>
                                        <td>{{ product.price }}</td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="4">No results found</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <!-- ********************************************************************************** -->
                        <!-- Asda Table -->
                        <!-- ********************************************************************************** -->
                        <div class="col-12 col-md-6">
                            <br>
                            <br>
                            <h3>Asda</h3>
                            <table class="table table-striped table-sm" id="asdaTable">
                                <thead>
                                    <tr>
                                        <th scope="col">Store</th>
                                        <th scope="col">Name</th>
                                        <th scope="col">Price</th>
                                        <th scope="col">Add</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for product in asda_products %}
                                    <tr>
                                        <td>{{ product.store }}</td>
                                        <td>{{ product.name }}</td>
                                        <td>{{ product.price }}</td>
                                        <td>
                                            <span class="add-to-basket" onclick="addToBasket(this)" data-store="Asda"
                                                data-name="{{ product.name }}" data-price="{{ product.price }}">+</span>
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="4">No results found</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <!-- ********************************************************************************** -->
                        <!-- Sainsburys Table -->
                        <!-- ********************************************************************************** -->
                        <div class="col-12 col-md-6 ">
                            <br>
                            <br>
                            <h3>Sainsburys</h3>
                            <table class="table table-striped table-sm" id="sainsburysTable">
                                <thead>
                                    <tr>
                                        <th scope="col">Store</th>
                                        <th scope="col">Name</th>
                                        <th scope="col">Price</th>
                                        <th scope="col">Add</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for product in sainsburys_products %}
                                    <tr>
                                        <td>{{ product.store }}</td>
                                        <td>{{ product.name }}</td>
                                        <td>{{ product.price }}</td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="4">No results found</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- ********************************************************************************** -->
                    <!-- Morrisons Table -->
                    <!-- ********************************************************************************** -->
                    <div class="col-12 col-md-6 ">
                        <br>
                        <br>
                        <h3>Morrisons</h3>
                        <table class="table table-striped table-sm" id="morrisonsTable">
                            <thead>
                                <tr>
                                    <th scope="col">Store</th>
                                    <th scope="col">Name</th>
                                    <th scope="col">Price</th>
                                    <th scope="col">Add</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for product in morrisons_products %}
                                <tr>
                                    <td>{{ product.store }}</td>
                                    <td>{{ product.name }}</td>
                                    <td>{{ product.price }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4">No results found</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <br>
        <br>
        {% include 'interface/pagination.html' %}
        <br>
        <br>
        <!-- Basket -->
        {% include 'interface/basket.html' %}
        <!-- Product Table -->
        <table>
            <tr>
            </tr>
            {% for product in products %}
            <tr>
                <td>{{ product.store }}</td>
                <td>{{ product.name }}</td>
                <td>{{ product.price }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>
        <!-- ********************************************************************************** -->
        <!-- JAVASCRIPT************************************************************************ -->
        <!-- ********************************************************************************** -->
        <script type="text/javascript">
            var addToBasketUrl = '{% url "add_to_basket" %}';
        </script>
        <script src="{% static 'js/asda_basket.js' %}"></script>
        <!-- Logout on image -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                document.getElementById('teabag-logout-link').addEventListener('click', function (event) {
                    event.preventDefault(); // Prevent the default anchor action
                    document.getElementById('logout-form').submit(); // Submit the logout form
                });
            });
        </script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const maxChecked = 3;
                const checkboxes = document.querySelectorAll('.store-checkbox');
                
                checkboxes.forEach(function(checkbox) {
                    checkbox.addEventListener('change', function() {
                        let checkedCheckboxes = document.querySelectorAll('.store-checkbox:checked');
                        if (checkedCheckboxes.length > maxChecked) {
                            this.checked = false;
                            alert('You can only select up to ' + maxChecked + ' stores for comparison.');
                        }
                    });
                });
            });
            </script>
{% endblock %}

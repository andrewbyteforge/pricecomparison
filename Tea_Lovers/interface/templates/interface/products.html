{% extends 'interface/base.html' %}
{% load static %}
{% block content %}
<!-- PRODUCT SEARCH BUTTONS -->
<div class="container ">
    <div class="row justify-content-center">
        <div class="col-lg-12 col-md-10">
            <!-- User Info, Teabag Image and Logout Button -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">

                <!-- Message Container -->
                <div class="messages-container" style="flex-grow: 0;">
                    <!-- Display Success/Error Messages -->
                    {% if messages %}
                    {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} fade-out-message">
                        {{ message }}
                    </div>
                    {% endfor %}
                    {% endif %}
                    <!-- Logged in as Information -->
                    <p class="logged-in-info" style="margin-bottom: 0;">Logged in as <b>{{ user.username }}</b>
                        &#128512;</p>
                </div>

                <!-- Flex Container for Teabag Image and Logout Button -->
                <div style="display: flex; align-items: center; justify-content: flex-end;">
                    <!-- Teabag Image -->
                    <div style="flex-shrink: 0; position: relative; z-index: 1; ">
                        <a href="#" id="teabag-logout-link">
                            <img src="{% static 'images/teabag-leaning.png' %}" alt="Teabag-Leaning"
                                style="height: 200px; margin-right: -50px; margin-bottom: 40px;">
                        </a>
                    </div>

                    <!-- Logout Button -->
                    <div style="flex-shrink: 0;">
                        <form id="logout-form" action="{% url 'logout' %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-warning btn shadow"
                                style="margin-right: 1px; ">LOGOUT</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- ********************************************************************************** -->
        <!-- Product Search FORM and store select -->
        <!-- ********************************************************************************** -->
        <div class="card my-5 grey-background outer-padding">
            <div class="card">
                <h5 class="card-header">Quick Product Search</h5>
                <div class="card-body">
                    <form action="{% url 'show_products' %}" method="get"
                        style="display: flex; flex-direction: column;">
                        {% csrf_token %}
                        <!-- Product Search Input -->
                        {{ form.as_p }}
                        <p>Enter product names separated by commas (e.g., oranges, tea)</p>
                        <!-- ********************************************************************************** -->
                        <!-- Store Selection Checkboxes -->
                        <!-- ********************************************************************************** -->

                        <!-- ********************************************************************************** -->
                        <!-- Tesco tick-->
                        <!-- ********************************************************************************** -->
                        <div class="form-check form-check-inline">
                            <input class="form-check-input store-checkbox" type="checkbox" name="store" value="Tesco"
                                id="checkTesco" data-target-table="tescoTable" data-target-basket="tescoBasket" 
                                {% if 'Tesco' in selected_stores %} checked {% endif %}>
                            <label class="form-check-label" for="checkTesco">Tesco</label>
                        </div>

                        <!-- ********************************************************************************** -->
                        <!-- Asda tick -->
                        <!-- ********************************************************************************** -->
                        <div class="form-check form-check-inline">
                            <input class="form-check-input store-checkbox" type="checkbox" name="store" value="Asda"
                                id="checkAsda" data-target-table="asdaTable" data-target-basket="asdaBasket" 
                                {% if 'Asda' in selected_stores %} checked {% endif %}>
                            <label class="form-check-label" for="checkTesco">Asda</label>
                        </div>


                        <!-- ********************************************************************************** -->
                        <!-- Sainsburys tick -->
                        <!-- ********************************************************************************** -->
                        <div class="form-check form-check-inline">
                            <input class="form-check-input store-checkbox" type="checkbox" name="store"
                                value="Sainsburys" id="checkSainsburys" data-target-table="sainsburysTable"
                                data-target-basket="sainsburysBasket" 
                                {% if 'Sainsburys' in selected_stores %} checked
                                {% endif %}>
                            <label class="form-check-label" for="checkTesco">Sainsburys</label>
                        </div>


                        <!-- ********************************************************************************** -->
                        <!-- Morrisons tick -->
                        <!-- ********************************************************************************** -->
                        <div class="form-check form-check-inline">
                            <input class="form-check-input store-checkbox" type="checkbox" name="store"
                                value="Morrisons" id="checkMorrisons" data-target-table="morrisonsTable"
                                data-target-basket="morrisonsBasket" 
                                {% if 'Morrisons' in selected_stores %} checked 
                                {% endif %}>
                            <label class="form-check-label" for="checkTesco">Morrisons</label>
                        </div>
                        <!-- ********************************************************************************** -->
                        <!-- Submit Button -->
                        <!-- ********************************************************************************** -->
                        <button type="submit" class="btn btn-primary mb-3 btn shadow">Search</button>
                    </form>
                </div>
                <!-- ********************************************************************************** -->
                <!-- Database Action Buttons -->
                <!-- ********************************************************************************** -->
                <div class="database-actions" style="padding-top: 20px;">
                    <!-- Delete DB Form -->
                    <form action="{% url 'delete_all_entries' %}" method="post" style="display: inline-block;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn shadow fs-6">Delete db</button>
                    </form>
                    <!-- ********************************************************************************** -->
                    <!-- Display DB Form -->
                    <!-- ********************************************************************************** -->
                    <form action="{% url 'display_database' %}" method="post"
                        style="display: inline-block; margin-left: 10px;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-primary btn shadow">Display db</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Tables displaying results from query -->
    <div class="container mt-3 spacing-bottom">
        <div class="card grey-background"> <!-- Apply the grey-background class here -->
            <div class="card-body custom-padding"> <!-- Apply custom-padding class here -->
                <div class="row">
                    <br>
                    <br>
                    <!-- ********************************************************************************** -->
                    <!-- Tesco Table -->
                    <!-- ********************************************************************************** -->
                    <div class="table-responsive" id="tescoTable">
                        <h3>Tesco</h3>
                        <table class="table table-striped table-sm">
                            <thead>
                                <tr>
                                    <th scope="col">Store</th>
                                    <th scope="col">Name</th>
                                    <th scope="col">Price</th>
                                    <th scope="col">Add</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for product in tesco_products %}
                                {% if product.store == 'Tesco' %}
                                <tr>
                                    <td>{{ product.store }}</td>
                                    <td>{{ product.name }}</td>
                                    <td>{{ product.price }}</td>
                                </tr>
                                {% endif %}
                                {% empty %}
                                <tr>
                                    <td colspan="4">No Tesco products found</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <br>
                    <br>

                    <!-- ********************************************************************************** -->
                    <!-- Asda Table -->
                    <!-- ********************************************************************************** -->
                    <div class="table-responsive" id="asdaTable">
                        <h3>Asda</h3>
                        <table class="table table-striped table-sm">
                            <thead>
                                <tr>
                                    <th scope="col">Store</th>
                                    <th scope="col">Name</th>
                                    <th scope="col">Price</th>
                                    <th scope="col">Add</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for product in asda_products %}
                                {% if product.store == 'Asda' %}
                                <tr>
                                    <td>{{ product.store }}</td>
                                    <td>{{ product.name }}</td>
                                    <td>{{ product.price }}</td>
                                    <td>
                                        <span class="add-to-basket" onclick="addToBasket(this)"
                                            data-id="{{ product.id }}" data-store="{{ product.store }}"
                                            data-name="{{ product.name }}" data-price="{{ product.price }}">+</span>
                                    </td>
                                </tr>
                                {% endif %}
                                {% empty %}
                                <tr>
                                    <td colspan="4">No Asda products found</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>


                    <!-- ********************************************************************************** -->
                    <!-- Sainsburys Table -->
                    <!-- ********************************************************************************** -->
                    <div class="table-responsive" id="sainsburysTable">
                        <h3>Sainsburys</h3>
                        <table class="table table-striped table-sm">
                            <thead>
                                <tr>
                                    <th scope="col">Store</th>
                                    <th scope="col">Name</th>
                                    <th scope="col">Price</th>
                                    <th scope="col">Add</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for product in sainsburys_products %}
                                {% if product.store == 'Sainsburys' %}
                                <tr>
                                    <td>{{ product.store }}</td>
                                    <td>{{ product.name }}</td>
                                    <td>{{ product.price }}</td>
                                </tr>
                                {% endif %}
                                {% empty %}
                                <tr>
                                    <td colspan="4">No Sainsburys products found</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <br>
                    <br>
                    <!-- ********************************************************************************** -->
                    <!-- Morrisons Table -->
                    <!-- ********************************************************************************** -->
                    <div class="table-responsive" id="morrisonsTable">
                        <h3>Morrisons</h3>
                        <table class="table table-striped table-sm">
                            <thead>
                                <tr>
                                    <th scope="col">Store</th>
                                    <th scope="col">Name</th>
                                    <th scope="col">Price</th>
                                    <th scope="col">Add</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for product in morrisons_products %}
                                {% if product.store == 'Morrisons' %}
                                <tr>
                                    <td>{{ product.store }}</td>
                                    <td>{{ product.name }}</td>
                                    <td>{{ product.price }}</td>

                                </tr>
                                {% endif %}
                                {% empty %}
                                <tr>
                                    <td colspan="4">No Tesco products found</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<br>
<br>
<br>
<br>






<!-- ********************************************************************************** -->
<!-- JAVASCRIPT************************************************************************ -->
<!-- ********************************************************************************** -->
<script type="text/javascript">
    var addToBasketUrl = '{% url "add_to_basket" %}';
</script>

<script src="{% static 'js/asda_basket.js' %}"></script>



<!-- ********************************************************************************** -->
<!-- Logout on image -->
<!-- ********************************************************************************** -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        document.getElementById('teabag-logout-link').addEventListener('click', function (event) {
            event.preventDefault(); // Prevent the default anchor action
            document.getElementById('logout-form').submit(); // Submit the logout form
        });
    });
</script>


<!-- ********************************************************************************** -->
<!-- Checkbox Limit Validation -->
<!-- ********************************************************************************** -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const maxChecked = 3;
        const checkboxes = document.querySelectorAll('.store-checkbox');

        checkboxes.forEach(function (checkbox) {
            checkbox.addEventListener('change', function () {
                let checkedCheckboxes = document.querySelectorAll('.store-checkbox:checked');
                if (checkedCheckboxes.length > maxChecked) {
                    this.checked = false;
                    alert('You can only select up to ' + maxChecked + ' stores for comparison.');
                }
            });
        });
    });
</script>

<!-- ********************************************************************************** -->
<!-- PAGINATION HTML -->
<!-- ********************************************************************************** -->
{% include 'interface/pagination.html' %}

<!-- ********************************************************************************** -->
<!-- BASKET HTML -->
<!-- ********************************************************************************** -->
{% include 'interface/basket.html' %}


<!-- ********************************************************************************** -->
<!-- end -->
<!-- ********************************************************************************** -->
{% endblock %}